.\" Automatically generated by Pandoc 2.3.1
.\"
.TH "s1kd\-refs" "1" "2020\-03\-04" "" "s1kd\-tools"
.hy
.SH NAME
.PP
s1kd\-refs \- Manage references between CSDB objects
.SH SYNOPSIS
.IP
.nf
\f[C]
s1kd\-refs\ [\-aBCcDEFfGHIiKLlmNnoPqRrSsTUuvwXxYZh?]\ [\-d\ <dir>]
\ \ \ \ \ \ \ \ \ \ [\-e\ <cmd>]\ [\-J\ <ns=URL>]\ [\-j\ <xpath>]\ [\-t\ <fmt>]
\ \ \ \ \ \ \ \ \ \ [\-3\ <file>]\ [<object>...]
\f[]
.fi
.SH DESCRIPTION
.PP
The \f[I]s1kd\-refs\f[] tool lists external references in CSDB objects,
optionally matching them to a filename in the CSDB directory hierarchy.
.PP
This allows you to:
.IP \[bu] 2
obtain a list of dependencies for CSDB objects, such as ICNs, to ensure
they are delivered together
.IP \[bu] 2
check for references to objects which do not exist in the current CSDB
.IP \[bu] 2
update reference metadata, such as titles, from the matched objects
.SH OPTIONS
.TP
.B \-a, \-\-all
List all references, both matched and unmatched.
.RS
.RE
.TP
.B \-B, \-C, \-D, \-E, \-G, \-H, \-K, \-L, \-P, \-S, \-T, \-Y, \-Z
List references to IPDs, comments, data modules, external publications,
ICNs, hotspots, CSNs, data management lists, publication modules, SCORM
content packages, referred fragments, repository source DMs and source
objects respectively.
If none are specified, \-BCDEGHKLPSTYZ is assumed.
.RS
.PP
The following long options can also be used for each: \-\-ipd, \-\-com,
\-\-dm, \-\-epr, \-\-icn, \-\-hotspot, \-\-csn, \-\-dml, \-\-pm,
\-\-smc, \-\-fragment, \-\-repository, \-\-source.
.RE
.TP
.B \-b, \-\-ipd\-sns <SNS>
Specify the SNS for non\-chapterized IPD data modules, in the form of
SYSTEM\-SUBSYSTEM\-ASSY (for example, "ZD\-00\-35").
This code is used to resolve non\-chapterized CSN references.
.RS
.PP
If "\-" is given for <SNS>, then the SNS will be derived from current
data module.
.RE
.TP
.B \-c, \-\-content
List references in the \f[C]content\f[] section of a CSDB object only.
.RS
.RE
.TP
.B \-d, \-\-dir <dir>
Directory to search for matches to references in.
By default, the current directory is used.
.RS
.RE
.TP
.B \-e, \-\-exec <cmd>
Execute a command for each referenced CSDB object matched.
The string "{}" is replaced by the current CSDB object file name
everywhere it occurs in the arguments to the command.
.RS
.RE
.TP
.B \-F, \-\-overwrite
When using the \-U or \-X options, overwrite the input objects that have
been updated or tagged.
.RS
.RE
.TP
.B \-f, \-\-filename
Include the filename of the source object where each reference was found
in the output.
.RS
.RE
.TP
.B \-h, \-?, \-\-help
Show help/usage message.
.RS
.RE
.TP
.B \-I, \-\-update\-issue
Update the issue number, issue date, language, and title of references
to that of the latest matched object.
This option implies the \-U and \-i options.
.RS
.RE
.TP
.B \-i, \-\-ignore\-issue
Ignore issue info when matching.
This will always match the latest issue of an object found, regardless
of the issue specified in the reference.
.RS
.RE
.TP
.B \-J <ns=URL>
Registers an XML namespace prefix, which can then be used in the hotspot
XPath expression (\-j).
Multiple namespaces can be registered by specifying this option multiple
times.
.RS
.RE
.TP
.B \-j <xpath>
Specify a custom XPath expression to use when matching hotspots (\-H) in
XML\-based ICN formats.
.RS
.RE
.TP
.B \-l, \-\-list
Treat input (stdin or arguments) as lists of filenames of CSDB objects
to list references in, rather than CSDB objects themselves.
.RS
.RE
.TP
.B \-m, \-\-strict\-match
Be more strict when matching codes of CSDB objects to filenames.
By default, the name of a file (minus the extension) only needs to start
with the code to be matched.
When this option is specified, the name must match the code exactly.
.RS
.PP
For example, the code "ABC" will normally match either of the files
"ABC.PDF" or "ABC_1.PDF", but when strict matching is enabled, it will
only match the former.
.RE
.TP
.B \-N, \-\-omit\-issue
Assume filenames of referenced CSDB objects omit the issue info, i.e.
they were created with the \-N option to the s1kd\-new* tools.
.RS
.RE
.TP
.B \-n, \-\-lineno
Include the filename of the source object where each reference was
found, and display the line number where the reference occurs in the
source file after its filename.
.RS
.RE
.TP
.B \-o, \-\-output\-valid
Output valid CSDB objects to stdout.
.RS
.RE
.TP
.B \-q, \-\-quiet
Quiet mode.
Errors are not printed.
.RS
.RE
.TP
.B \-R, \-\-recursively
List references in matched objects recursively.
.RS
.RE
.TP
.B \-r, \-\-recursive
Search for matches to references in directories recursively.
.RS
.RE
.TP
.B \-s, \-\-include\-src
Include the source object as a reference.
This is helpful when the output of this tool is used to apply some
operation to a source object and all its dependencies together.
.RS
.RE
.TP
.B \-t, \-\-format <fmt>
Specify a custom format for printed references.
<fmt> is a format string, where the following variables can be given:
.RS
.IP \[bu] 2
%line% \- The line number where the reference occurs in the source.
.IP \[bu] 2
%ref% \- The reference.
.IP \[bu] 2
%src% \- The source of the reference.
.IP \[bu] 2
%xpath% \- The XPath denoting where the reference occurs in the source.
.PP
For example, \f[C]\-t\ \[aq]%src%\ (%line%):\ %ref%\[aq]\f[] is
equivalent to the \-n option.
.RE
.TP
.B \-U, \-\-update
Update the title of matched references from the corresponding object.
.RS
.RE
.TP
.B \-u, \-\-unmatched
Show only unmatched reference errors, or unmatched codes if combined
with the \-a option.
.RS
.RE
.TP
.B \-v, \-\-verbose
Verbose output.
.RS
.RE
.TP
.B \-w, \-\-where\-used
Instead of listing references contained within specified objects, list
places within other objects where the specified objects are referenced.
.RS
.PP
In this case, <object> may also be a code (with the appropriate prefix)
instead of an actual file.
For example:
\f[C]s1kd\-refs\ \-w\ DMC\-TEST\-A\-00\-00\-00\-00A\-040A\-D\f[]
.RE
.TP
.B \-X, \-\-tag\-unmatched
Tag unmatched references with the processing instruction
\f[C]<?unmatched?>\f[].
.RS
.RE
.TP
.B \-x, \-\-xml
Output a detailed XML report instead of plain text messages.
.RS
.RE
.TP
.B \-3, \-\-externalpubs <file>
Use a custom \f[C]\&.externalpubs\f[] file.
.RS
.RE
.TP
.B \-\-version
Show version information.
.RS
.RE
.TP
.B <object>...
CSDB object(s) to list references in.
If none are specified, the tool will read from stdin.
.RS
.RE
.PP
In addition, the following options enable features of the XML parser
that are disabled as a precaution by default:
.TP
.B \-\-dtdload
Load the external DTD.
.RS
.RE
.TP
.B \-\-net
Allow network access to load external DTD and entities.
.RS
.RE
.TP
.B \-\-noent
Resolve entities.
.RS
.RE
.TP
.B \-\-xinclude
Do XInclude processing.
.RS
.RE
.SS \f[C]\&.externalpubs\f[] file
.PP
The \f[C]\&.externalpubs\f[] file contains definitions of external
publication references.
This can be used to update external publication references in CSDB
objects with \-U.
.PP
By default, the tool will search the current directory and parent
directories for a file named .externalpubs, but any file can be
specified by using the \-e option.
.PP
Example of a \f[C]\&.externalpubs\f[] file:
.IP
.nf
\f[C]
<externalPubs>
<externalPubRef>
<externalPubRefIdent>
<externalPubCode>ABC</externalPubCode>
<externalPubTitle>ABC\ Manual</externalPubTitle>
</externalPubRefIdent>
</externalPubRef>
</externalPubs>
\f[]
.fi
.PP
External publication references will be updated whether they are matched
to a file or not.
.SS Hotspot matching (\-H)
.PP
Hotspots can be matched in XML\-based ICN formats, such as SVG or X3D.
By default, matching is based on the APS ID of the hotspot and the
following attributes:
.TP
.B SVG
\f[C]\@id\f[]
.RS
.RE
.TP
.B X3D
\f[C]\@DEF\f[]
.RS
.RE
.PP
If hotspots are identified in a different way in a project\[aq]s ICNs, a
custom XPath expression can be specified with the \-j option.
In this XPath expression, the variable \f[C]$id\f[] represents the
hotspot APS ID:
.IP
.nf
\f[C]
$\ s1kd\-refs\ \-H\ \-j\ "//*[\@attr\ =\ $id]"\ <DM>
\f[]
.fi
.SH EXIT STATUS
.TP
.B 0
No errors, all references were matched.
.RS
.RE
.TP
.B 1
Some references were unmatched.
.RS
.RE
.TP
.B 2
The number of objects found in a recursive check (\-R) exceeded the
available memory.
.RS
.RE
.TP
.B 3
stdin did not contain valid XML and not in list mode (\-l).
.RS
.RE
.TP
.B 4
The non\-chapterized SNS specified (\-b) is not valid.
.RS
.RE
.SH EXAMPLE
.IP
.nf
\f[C]
$\ s1kd\-refs\ DMC\-EX\-A\-00\-00\-00\-00A\-040A\-D_000\-01_EN\-CA.XML
DMC\-EX\-A\-00\-00\-00\-00A\-022A\-D_001\-00_EN\-CA.XML
DMC\-EX\-A\-01\-00\-00\-00A\-040A\-D_000\-01_EN\-CA.XML
ICN\-12345\-00001\-001\-01.JPG
\f[]
.fi
.SH AUTHORS
khzae.net.
