.\" Automatically generated by Pandoc 2.3.1
.\"
.TH "s1kd\-brexcheck" "1" "2021\-04\-16" "" "s1kd\-tools"
.hy
.SH NAME
.PP
s1kd\-brexcheck \- Validate S1000D CSDB objects against BREX data
modules
.SH SYNOPSIS
.IP
.nf
\f[C]
s1kd\-brexcheck\ [\-b\ <brex>]\ [\-d\ <dir>]\ [\-I\ <path>]\ [\-w\ <severities>]
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\-X\ <version>]\ [\-F|\-f]\ [\-BceLlNnopqrS[tu]sTvx^h?]
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [<object>...]
\f[]
.fi
.SH DESCRIPTION
.PP
The \f[I]s1kd\-brexcheck\f[] tool validates S1000D CSDB objects using
the context, SNS, and/or notation rules of one or multiple Business
Rules EXchange (BREX) data modules.
All errors are displayed with the <objectUse> message, the line number,
and a representation of the invalid XML tree.
.SH OPTIONS
.TP
.B \-B, \-\-default\-brex
Check each input object against the appropriate built\-in S1000D default
BREX only.
The actual BREX reference of each object is ignored.
.RS
.RE
.TP
.B \-b, \-\-brex <brex>
Check the CSDB objects against this BREX.
Multiple BREX data modules can be specified by adding this option
multiple times.
When no BREX data modules are specified, the BREX data module referenced
in <brexDmRef> in the CSDB object is attempted to be used instead.
.RS
.RE
.TP
.B \-c, \-\-values
When a context rule defines values for an object (objectValue), check if
the value of each object is within the allowed set of values.
.RS
.RE
.TP
.B \-d, \-\-dir <dir>
Directory to start searching for BREX data modules in.
By default, the current directory is used.
.RS
.RE
.TP
.B \-e, \-\-ignore\-empty
Ignore check for empty or non\-XML documents.
.RS
.RE
.TP
.B \-F, \-\-valid\-filenames
Print the filenames of CSDB objects with no BREX/SNS errors.
.RS
.RE
.TP
.B \-f, \-\-filenames
Print the filenames of CSDB objects with BREX/SNS errors.
.RS
.RE
.TP
.B \-h, \-?, \-\-help
Show the help/usage message.
.RS
.RE
.TP
.B \-I, \-\-include <path>
Add a search path for BREX data modules.
By default, only the current directory is searched.
.RS
.RE
.TP
.B \-L, \-\-list
Treat input as a list of object filenames to check, rather than an
object itself.
.RS
.RE
.TP
.B \-l, \-\-layered
Use the layered BREX concept.
BREX data modules referenced by other BREX data modules (either
specified with \-b or referenced by the specified CSDB objects) will
also be checked against.
.RS
.RE
.TP
.B \-N, \-\-omit\-issue
Assume that the issue/inwork numbers are omitted from object filenames
(they were created with the \-N option).
.RS
.RE
.TP
.B \-n, \-\-notations
Check notation rules.
Any notation names listed in any of the BREX data modules with attribute
\f[C]allowedNotationFlag\f[] set to "1" or omitted are considered valid
notations.
If a notation in a CSDB object is not present or has
\f[C]allowedNotationFlag\f[] set to "0", an error will be returned.
.RS
.PP
For notations not included but not explicitly excluded, the
\f[C]objectUse\f[] of the first inclusion rule will be returned with the
error.
For explicitly excluded notations, the \f[C]objectUse\f[] of the
explicit exclusion rule is returned.
.RE
.TP
.B \-o, \-\-output\-valid
Output valid CSDB objects to stdout.
.RS
.RE
.TP
.B \-p, \-\-progress
Display a progress bar.
.RS
.RE
.TP
.B \-q, \-\-quiet
Quiet mode.
No errors are printed, they are only indicated via the exit status.
.RS
.RE
.TP
.B \-r, \-\-recursive
Search for BREX data modules recursively.
.RS
.RE
.TP
.B \-S[tu], \-\-sns [\-\-strict|\-\-unstrict]
Check Standard Numbering System (SNS) rules.
The SNS of each specified data module is checked against the combination
of all SNS rules of all specified BREX data modules.
.RS
.RE
.TP
.B \-s, \-\-short
Use shortened, single\-line messages to report BREX errors instead of
multiline indented messages.
.RS
.RE
.TP
.B \-T, \-\-summary
Print a summary of the check after it completes, including statistics on
the number of documents that passed/failed the check.
.RS
.RE
.TP
.B \-v, \-\-verbose
Verbose mode.
The success or failure of each test is printed explicitly.
.RS
.RE
.TP
.B \-w, \-\-severity\-levels <file>
Specify a list of severity levels for business rules.
.RS
.RE
.TP
.B \-X, \-\-xpath\-version <version>
Force the specified version of XPath to be used when evaluating the
object paths of BREX rules.
.RS
.RE
.TP
.B \-x, \-\-xml
Output an XML report.
.RS
.RE
.TP
.B \-^, \-\-remove\-deleted
Check the CSDB objects with elements that have a change type of "delete"
removed.
.RS
.RE
.TP
.B \-\-version
Show version information.
.RS
.RE
.PP
In addition, the following options allow configuration of the XML
parser:
.TP
.B \-\-dtdload
Load the external DTD.
.RS
.RE
.TP
.B \-\-huge
Remove any internal arbitrary parser limits.
.RS
.RE
.TP
.B \-\-net
Allow network access to load external DTD and entities.
.RS
.RE
.TP
.B \-\-noent
Resolve entities.
.RS
.RE
.TP
.B \-\-parser\-errors
Emit errors from parser.
.RS
.RE
.TP
.B \-\-parser\-warnings
Emit warnings from parser.
.RS
.RE
.TP
.B \-\-xinclude
Do XInclude processing.
.RS
.RE
.TP
.B \-\-xml\-catalog <file>
Use an XML catalog when resolving entities.
Multiple catalogs may be loaded by specifying this option multiple
times.
.RS
.RE
.SS Business rule severity levels (\f[C]\&.brseveritylevels\f[])
.PP
The attribute \f[C]brSeverityLevel\f[] on a BREX rule allows for
distinguishing different kinds of errors.
The \f[C]\&.brseveritylevels\f[] file contains a list of severity
levels, their user\-defined type, and optionally if they should not be
counted as true errors (causing the tool to return a "failure" status)
but merely warnings.
.PP
By default, the program will search the current directory and parent
directories for a file named \f[C]\&.brseveritylevels\f[], but any file
can be specified by using the \-w option.
.PP
An example of the format of this file is given below:
.IP
.nf
\f[C]
<?xml\ version="1.0"?>
<brSeverityLevels>
<brSeverityLevel\ value="brsl01"\ fail="yes">Error</brSeverityLevel>
<brSeverityLevel\ value="brsl02"\ fail="no">Warning</brSeverityLevel>
</brSeverityLevels>
\f[]
.fi
.PP
When the attribute \f[C]fail\f[] has a value of \f[C]"yes"\f[] (or is
not included), BREX errors pertaining to rules with the given severity
level value will be counted as errors.
When it is \f[C]"no"\f[], the errors are still displayed but are not
counted as errors in the exit status code of the tool.
.SS Normal, strict and unstrict SNS check (\-S, \-St, \-Su)
.PP
There are three modes for SNS checking: normal, strict, and unstrict.
The main difference between them is how they handle the optional levels
of an SNS description in the BREX.
.PP
\-St enables \f[I]strict\f[] SNS checking.
By default, the normal SNS check (\-S) will assume optional elements
snsSubSystem, snsSubSubSystem, and snsAssy exist with an snsCode of "0"
("00" or "0000" for snsAssy) when their parent element does not contain
any of each.
This provides a shorthand, such that
.IP
.nf
\f[C]
<snsSystem>
<snsCode>00</snsCode>
<snsTitle>General</snsTitle>
</snsSystem>
\f[]
.fi
.PP
is equivalent to
.IP
.nf
\f[C]
<snsSystem>
<snsCode>00</snsCode>
<snsTitle>General</snsTitle>
<snsSubSystem>
<snsCode>0</snsCode>
<snsTitle>General</snsTitle>
<snsSubSubSystem>
<snsCode>0</snsCode>
<snsTitle>General</snsTitle>
<snsAssy>
<snsCode>00</snsCode>
<snsTitle>General</snsTitle>
</snsAssy>
</snsSubSubSystem>
</snsSubSystem>
</snsSystem>
\f[]
.fi
.PP
Using strict checking will disable this shorthand, and missing optional
elements will result in an error.
.PP
\-Su enables \f[I]unstrict\f[] SNS checking.
The normal SNS check (\-S) shorthand mentioned above only allows SNS
codes of "0" to be omitted from the SNS rules.
Using unstrict checking, \f[I]any\f[] code used will not produce an
error when the relevant optional elements are omitted.
This means that given the following...
.IP
.nf
\f[C]
<snsSystem>
<snsCode>00</snsCode>
<snsTitle>General</snsTitle>
</snsSystem>
\f[]
.fi
.PP
\&...SNS codes of 00\-00\-0000 through 00\-ZZ\-ZZZZ are considered
valid.
.SS Object value checking (\-c)
.PP
There are two ways to restrict the allowable values of an object in a
BREX rule.
One is to use the XPath expression itself.
For example, this expression will match any
\f[C]securityClassification\f[] attribute whose value is neither
\f[C]"01"\f[] nor \f[C]"02"\f[], and because the
\f[C]allowedObjectFlag\f[] is \f[C]"0"\f[], will generate a BREX error
if any match is found:
.IP
.nf
\f[C]
<objectPath\ allowedObjectFlag="0">
//\@securityClassification[
\&.\ !=\ \[aq]01\[aq]\ and
\&.\ !=\ \[aq]02\[aq]
]
</objectPath>
\f[]
.fi
.PP
However, this method can lead to fairly complex expressions and requires
a reversal of logic.
The BREX schema provides an alternative method using the element
\f[C]objectValue\f[]:
.IP
.nf
\f[C]
<structureObjectRule>
<objectPath\ allowedObjectFlag="2">
//\@securityClassification
</objectPath>
<objectValue\ valueAllowed="01">Unclassified</objectValue>
<objectValue\ valueAllowed="02">Classified</objectValue>
</structureObjectRule>
\f[]
.fi
.PP
Specifying the \-c option will enable checking of these types of rules,
and if the value is not within the allowed set a BREX error will be
reported.
The \f[C]valueForm\f[] attribute can be used to specify what kind of
notation the \f[C]valueAllowed\f[] attribute will contain:
.IP \[bu] 2
\f[C]"single"\f[] \- A single, exact value.
.IP \[bu] 2
\f[C]"range"\f[] \- Values given in the S1000D range/set notation, e.g.
\f[C]"a~c"\f[] or \f[C]"a|b|c"\f[].
.IP \[bu] 2
\f[C]"pattern"\f[] \- A regular expression.
.PP
The s1kd\-brexcheck tool supports all three types.
If the \f[C]valueForm\f[] attribute is omitted, it will assume the value
is in the \f[C]"single"\f[] notation.
.SS XPath support
.PP
By default, s1kd\-brexcheck supports only XPath 1.0, with partial
support for EXSLT functions.
.PP
If experimental XPath 2.0 support is enabled at compile\-time,
s1kd\-brexcheck will automatically choose a version of XPath based on
the S1000D issue of the BREX data module:
.TP
.B 3.0 and lower
XPath 1.0
.RS
.RE
.TP
.B 4.0 and up
XPath 2.0
.RS
.RE
.PP
The \-X (\-\-xpath\-version) option can be specified to force a
particular version of XPath to be used regardless of issue.
Information on which XPath versions are supported can be obtained from
the \-\-version option.
.PP
If the XPath given for the \f[C]<objectPath>\f[] of a rule is invalid,
the rule will be ignored when validating objects.
A warning will be printed to stderr, and the XML report will contain an
\f[C]<xpathError>\f[] element for each error.
.SH EXIT STATUS
.TP
.B 0
Check completed successfully, and no CSDB objects had BREX errors.
.RS
.RE
.TP
.B 1
Check completed successfully, but some CSDB objects had BREX errors.
.RS
.RE
.TP
.B 2
One or more CSDB objects specified could not be read.
.RS
.RE
.TP
.B 3
A referenced BREX data module could not be found.
.RS
.RE
.TP
.B 4
The XPath version specified is unsupported.
.RS
.RE
.TP
.B 5
The number of paths or CSDB objects specified exceeded the available
memory.
.RS
.RE
.SH EXAMPLE
.IP
.nf
\f[C]
$\ DMOD=DMC\-EX\-A\-00\-00\-00\-00A\-040A\-D_000\-01_EN\-CA.XML
$\ BREX=DMC\-S1000D\-G\-04\-10\-0301\-00A\-022A\-D_001\-00_EN\-US.XML
$\ cat\ $DMOD
[...]
<listItem\ id="stp\-0001">
<para>List\ items\ shouldn\[aq]t\ be\ used\ as\ steps...</para>
</listItem>
[...]
<para>Refer\ to\ <internalRef\ internalRefId="stp\-0001"
internalRefTargetType="irtt08"/>.</para>
[...]

$\ s1kd\-brexcheck\ \-b\ $BREX\ $DMOD
BREX\ ERROR:\ DMC\-EX\-A\-00\-00\-00\-00A\-040A\-D_000\-01_EN\-CA.XML
\ \ BREX:\ DMC\-S1000D\-G\-04\-10\-0301\-00A\-022A\-D_001\-00_EN\-US.XML
\ \ BREX\-S1\-00052
\ \ Only\ when\ the\ reference\ target\ is\ a\ step\ can\ the\ value\ of\ attribute
internalRefTargetType\ be\ irtt08\ (Chap\ 3.9.5.2.1.2,\ Para\ 2.1).
\ \ line\ 52\ (/dmodule[1]/content[1]/description[1]/para[2]/
internalRef[1]):
\ \ \ \ ELEMENT\ internalRef
\ \ \ \ \ \ ATTRIBUTE\ internalRefTargetType
\ \ \ \ \ \ \ \ TEXT
\ \ \ \ \ \ \ \ \ \ content=irtt08
\ \ \ \ \ \ ATTRIBUTE\ internalRefId
\ \ \ \ \ \ \ \ TEXT
\ \ \ \ \ \ \ \ \ \ content=stp\-0001
\f[]
.fi
.PP
Example of XML report format for the above:
.IP
.nf
\f[C]
<?xml\ version="1.0"?>
<brexCheck>
<document\ path="DMC\-EX\-A\-00\-00\-00\-00A\-040A\-D_000\-01_EN\-CA.XML">
<brex\ path="DMC\-S1000D\-G\-04\-10\-0301\-00A\-022A\-D_001\-00_EN\-US.XML">
<error\ fail="yes">
<brDecisionRef\ brDecisionIdentNumber="BREX\-S1\-00052"/>
<objectPath\ allowedObjectFlag="0">...</objectPath>
<objectUse>Only\ when\ the\ refernce\ target\ is\ a\ step\ can\ the\ value\ of
attribute\ internalRefTargetType\ be\ irtt08
(Chap\ 3.9.5.2.1.2,\ Para\ 2.1).</objectUse>
<object\ line="52"
xpath="/dmodule[1]/content[1]/description[1]/para[2]/internalRef[1]">
<internalRef\ internalRefId="stp\-0001"
internalRefTargetType="irtt08"/>
</object>
</error>
</brex>
</document>
</brexCheck>
\f[]
.fi
.SH AUTHORS
khzae.net.
